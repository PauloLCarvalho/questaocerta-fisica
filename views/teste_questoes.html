<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teste de Quest√µes</title>
  <style>
    body { font-family: system-ui; padding: 20px; max-width: 1000px; margin: 0 auto; }
    h1 { color: #0e70fa; }
    pre { background: #f5f5f5; padding: 15px; border-radius: 8px; overflow: auto; font-size: 0.85rem; }
    .filtros { background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px 0; }
    button { background: #0e70fa; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-right: 10px; }
    button:hover { background: #0d66e0; }
    .resultado { margin-top: 20px; padding: 15px; background: #fff; border: 1px solid #ddd; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>üîß Teste do Sistema de Quest√µes</h1>
  
  <div class="filtros">
    <h3>Filtros de Teste</h3>
    <p>
      <label>Grande √Årea: 
        <select id="area">
          <option value="">Todas</option>
          <option value="matematica">Matem√°tica</option>
          <option value="natureza">Ci√™ncias da Natureza</option>
          <option value="humanas">Ci√™ncias Humanas</option>
          <option value="linguagens">Linguagens</option>
        </select>
      </label>
    </p>
    <p>
      <label>Componente: 
        <select id="componente">
          <option value="">Todos</option>
          <option value="matematica">Matem√°tica</option>
          <option value="fisica">F√≠sica</option>
          <option value="biologia">Biologia</option>
          <option value="quimica">Qu√≠mica</option>
          <option value="historia">Hist√≥ria</option>
          <option value="geografia">Geografia</option>
        </select>
      </label>
    </p>
    <p>
      <label>N√≠vel: 
        <select id="nivel">
          <option value="">Todos</option>
          <option value="facil">F√°cil</option>
          <option value="medio">M√©dio</option>
          <option value="dificil">Dif√≠cil</option>
          <option value="impossivel">Imposs√≠vel</option>
        </select>
      </label>
    </p>
    <button onclick="testarFiltros()">üîç Testar Filtros</button>
    <button onclick="testarTodas()">üìö Carregar Todas</button>
  </div>

  <div class="resultado">
    <h3>Resultado:</h3>
    <pre id="output">Clique em um dos bot√µes acima para testar...</pre>
  </div>

  <script src="../js/questoes.js"></script>
  <script>
    async function testarTodas() {
      const output = document.getElementById('output');
      output.textContent = 'Carregando...';
      
      try {
        await QuestoesAPI.carregarBanco();
        const total = QuestoesAPI.todasQuestoes.length;
        
        // Agrupar por grande_area
        const porArea = {};
        QuestoesAPI.todasQuestoes.forEach(q => {
          const area = q.grande_area || q.materia || 'sem_area';
          porArea[area] = (porArea[area] || 0) + 1;
        });
        
        // Agrupar por nivel
        const porNivel = {};
        QuestoesAPI.todasQuestoes.forEach(q => {
          const nivel = q.nivel || 'sem_nivel';
          porNivel[nivel] = (porNivel[nivel] || 0) + 1;
        });
        
        let result = `‚úÖ TOTAL DE QUEST√ïES: ${total}\n\n`;
        result += `üìä POR GRANDE √ÅREA:\n`;
        Object.entries(porArea).forEach(([k, v]) => {
          result += `  ‚Ä¢ ${k}: ${v} quest√µes\n`;
        });
        
        result += `\nüìä POR N√çVEL:\n`;
        Object.entries(porNivel).forEach(([k, v]) => {
          result += `  ‚Ä¢ ${k}: ${v} quest√µes\n`;
        });
        
        result += `\nüìù EXEMPLO DA PRIMEIRA QUEST√ÉO:\n`;
        result += JSON.stringify(QuestoesAPI.todasQuestoes[0], null, 2);
        
        output.textContent = result;
      } catch (err) {
        output.textContent = `‚ùå ERRO: ${err.message}\n\n${err.stack}`;
      }
    }

    async function testarFiltros() {
      const output = document.getElementById('output');
      output.textContent = 'Filtrando...';
      
      try {
        await QuestoesAPI.carregarBanco();
        
        const area = document.getElementById('area').value;
        const componente = document.getElementById('componente').value;
        const nivel = document.getElementById('nivel').value;
        
        const filtradas = QuestoesAPI.todasQuestoes.filter(q => {
          let match = true;
          if (area) match = match && (q.grande_area === area || q.materia === area);
          if (componente) match = match && (q.componente === componente);
          if (nivel) match = match && (q.nivel === nivel);
          return match;
        });
        
        let result = `üîç FILTROS APLICADOS:\n`;
        result += `  ‚Ä¢ Grande √Årea: ${area || 'Todas'}\n`;
        result += `  ‚Ä¢ Componente: ${componente || 'Todos'}\n`;
        result += `  ‚Ä¢ N√≠vel: ${nivel || 'Todos'}\n\n`;
        result += `‚úÖ QUEST√ïES ENCONTRADAS: ${filtradas.length}\n\n`;
        
        if (filtradas.length > 0) {
          result += `üìù PRIMEIRAS 3 QUEST√ïES:\n`;
          filtradas.slice(0, 3).forEach((q, i) => {
            result += `\n${i+1}. ID: ${q.id}\n`;
            result += `   √Årea: ${q.grande_area || q.materia}\n`;
            result += `   Componente: ${q.componente}\n`;
            result += `   N√≠vel: ${q.nivel}\n`;
            result += `   Enunciado: ${q.enunciado.substring(0, 60)}...\n`;
          });
        }
        
        output.textContent = result;
      } catch (err) {
        output.textContent = `‚ùå ERRO: ${err.message}\n\n${err.stack}`;
      }
    }
  </script>
</body>
</html>
